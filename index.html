<!doctype html>

<title>Amalog CodeMirror Mode</title>
<meta charset="utf-8"/>

<script src="codemirror/lib/codemirror.js"></script>
<script src="codemirror/keymap/emacs.js"></script>
<link rel=stylesheet href="codemirror/lib/codemirror.css">
<link rel=stylesheet href="amalog.css">
<script src="amalog.js"></script>

<article>

<section id=demo>
  <h2>This is CodeMirror</h2>
  <textarea id=demotext>
// here is a comment
about main
    mode +list is det
main _Argv
    say `hello raw strings`
    say hello // atoms have no quoted form
    say "hello to sugary strings"
    lengthy Msg
    say Msg
    X is 7 + 2.398
    Negative = -3.74
    complex_predicate
        really long argument with stuff
        another argument number 2
        third lengthy argument (for Y)
    say Y
    load Ref Val
    store Ref [Val Val]


/*
This predicate defines a long
message which needs to be split across
multiple lines. Just like this comment.
*/
lengthy `hello
multiline
strings`
</textarea>
  
  <script>
    var editor = CodeMirror.fromTextArea(document.getElementById("demotext"), {
      lineNumbers: true,
      indentUnit: 4,
      indentWithTabs: false,
      electricChars: true,
      keyMap: 'emacs',
      extraKeys: {
        /*
        "Backspace": function (cm) {
            if (cm.somethingSelected()) return CodeMirror.Pass;
            var cursor = cm.getCursor("start");
            if (cursor.ch < 4) return CodeMirror.Pass;
            var back = {
                line: cursor.line,
                ch: cursor.ch - 4,
            };
            var text = cm.getRange(back, cursor);
            if (text=="    ") {
                cm.replaceSelection("", back, cursor);
                return;
            }
            return CodeMirror.Pass;
        },
        */
        "Enter": "newlineAndIndent",
        "Tab": function (cm) {
            cm.replaceSelection("    ", "end", "+input");
        },
      },
    });
  </script>
</section>

</article>
